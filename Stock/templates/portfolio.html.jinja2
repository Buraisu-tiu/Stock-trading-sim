{% extends "base.html.jinja2" %}
{% block content %}
<style>
    body {
        background: 
            radial-gradient(circle at 10% 20%, rgba(0, 0, 255, 0.05) 0%, transparent 20%),
            radial-gradient(circle at 90% 80%, rgba(255, 0, 0, 0.05) 0%, transparent 20%),
            linear-gradient(135deg, {{ user.background_color if user and user.background_color else '#0a0a0a' }} 0%, #000000 100%);
        background-attachment: fixed;
        color: #ffffff;
        font-family: 'Inter', sans-serif;
        min-height: 100vh;
        margin: 0;
        padding: 2rem;
        overflow-x: hidden;
    }

    .container-centered {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(12px);
        border-radius: 24px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    /* Header Section */
    .profile-section {
        display: flex;
        align-items: center;
        gap: 2rem;
        margin-bottom: 3rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .profile-picture {
        width: 120px;
        height: 120px;
        border-radius: 24px;
        object-fit: cover;
        border: 2px solid {{ user.accent_color if user and user.accent_color else '#007bff' }};
        box-shadow: 0 0 20px rgba({{ (user.accent_color if user and user.accent_color else '#007bff') | hex_to_rgb }}, 0.3);
        transition: transform 0.3s ease;
    }

    .profile-picture:hover {
        transform: scale(1.05);
    }

    .profile-info {
        flex-grow: 1;
    }

    .Ptitle {
        font-size: 2.5rem;
        margin: 0 0 0.5rem 0;
        background: linear-gradient(45deg, #fff, {{ user.accent_color if user and user.accent_color else '#007bff' }});
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .user_balance {
        font-size: 1.5rem;
        margin: 0;
        opacity: 0.9;
    }

    /* Badges Grid */
    .badges {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin: 2rem 0;
    }

    .badge {
        background: rgba(255, 255, 255, 0.05);
        padding: 1.5rem;
        border-radius: 16px;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .badge:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.08);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    .badge h3 {
        margin: 0 0 0.5rem 0;
        color: {{ user.accent_color if user and user.accent_color else '#007bff' }};
    }

    .badge p {
        margin: 0;
        opacity: 0.8;
        line-height: 1.5;
    }

    /* Enhanced Table */
    .leaderboard-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 8px;
        margin: 2rem 0;
    }

    .leaderboard-table th {
        background: transparent;
        color: rgba(255, 255, 255, 0.6);
        padding: 1rem;
        text-align: left;
        font-weight: 500;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .leaderboard-table td {
        background: rgba(255, 255, 255, 0.03);
        padding: 1rem;
        transition: all 0.3s ease;
    }

    .leaderboard-table tr:hover td {
        background: rgba(255, 255, 255, 0.06);
        transform: scale(1.01);
    }

    .leaderboard-table tr td:first-child {
        border-top-left-radius: 12px;
        border-bottom-left-radius: 12px;
    }

    .leaderboard-table tr td:last-child {
        border-top-right-radius: 12px;
        border-bottom-right-radius: 12px;
    }

    /* Portfolio Value Section */
    .portfolio-summary {
        text-align: center;
        margin: 3rem 0;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .displayvalue {
        font-size: 1.2rem;
        margin: 0;
        opacity: 0.7;
    }

    .total_value {
        font-size: 3rem;
        margin: 0.5rem 0;
        background: linear-gradient(45deg, #fff, {{ user.accent_color if user and user.accent_color else '#007bff' }});
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    /* Button Styling */
    .register-button {
        display: inline-block;
        padding: 1rem 2rem;
        background: {{ user.accent_color if user and user.accent_color else '#007bff' }};
        color: white;
        text-decoration: none;
        border-radius: 12px;
        transition: all 0.3s ease;
        border: none;
        font-weight: 500;
        margin-top: 2rem;
    }

    .register-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba({{ (user.accent_color if user and user.accent_color else '#007bff') | hex_to_rgb }}, 0.4);
    }

    @media (max-width: 768px) {
        body {
            padding: 1rem;
        }

        .container-centered {
            padding: 1rem;
        }

        .profile-section {
            flex-direction: column;
            text-align: center;
            gap: 1rem;
        }

        .profile-picture {
            width: 100px;
            height: 100px;
        }

        .Ptitle {
            font-size: 2rem;
        }

        .leaderboard-table {
            display: block;
            overflow-x: auto;
            white-space: nowrap;
        }
    }
</style>

<div class="container-centered">
    <div class="profile-section">
        <img src="{{ user.profile_picture }}" alt="Profile Picture" class="profile-picture">
        <div class="profile-info">
            <h1 class="Ptitle">{{ user.username }}'s Portfolio</h1>
            <p class="user_balance">Account balance: ${{ user.balance }}</p>
        </div>
    </div>

    <div class="badges">
        {% for badge in badges %}
        <div class="badge">
            <h3>{{ badge.name }}</h3>
            <p>{{ badge.description }}</p>
        </div>
        {% endfor %}
    </div>

    <table class="leaderboard-table">
        <thead>
            <tr>
                <th>Symbol</th>
                <th>Type</th>
                <th>Quantity</th>
                <th>Purchase Price</th>
                <th>Current Price</th>
                <th>Total Value</th>
                <th>Profit/Loss</th>
                <th>P/L %</th>
            </tr>
        </thead>
        <tbody>
            {% for asset in portfolio %}
            <tr>
                <td>{{ asset.symbol }}</td>
                <td>{{ asset.asset_type|capitalize }}</td>
                <td>{{ asset.shares }}</td>
                <td>${{ asset.purchase_price }}</td>
                <td>${{ asset.latest_price }}</td>
                <td>${{ asset.value }}</td>
                <td>${{ ((asset.latest_price - asset.purchase_price) * asset.shares) | round(2) }}</td>
                <td>
                    {% if asset.purchase_price != 0 %}
                    {{ (((asset.latest_price - asset.purchase_price) / asset.purchase_price) * 100) | round(2) }}%
                    {% else %}
                    N/A
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="portfolio-summary">
        <h2 class="displayvalue">Total Portfolio Value</h2>
        <h2 class="total_value">${{ total_value }}</h2>
        <a href="{{ url_for('leaderboard') }}" class="register-button">Back to Leaderboard</a>
    </div>
</div>
{% endblock %}