{% extends "base.html.jinja2" %}

{% block content %}
<style>
    body {
        background: 
          radial-gradient(circle at 10% 50%, rgba(255,255,255,0.05) 1px, transparent 1px) 0 0,
          radial-gradient(circle at 10% 50%, rgba(255,255,255,0.05) 1px, transparent 1px) 10px 10px,
          linear-gradient(135deg, {{ user.background_color if user and user.background_color else '#1a1a1a' }} 0%, #000000 100%);
        background-size: 20px 20px, 20px 20px, 100% 100%;
        background-position: center;
        background-attachment: fixed;
        color: #ffffff;
        font-family: 'Arial', sans-serif;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        position: relative;
        z-index: 1;
        overflow-y: auto;
        animation: animateBackground 60s infinite linear;
      }
      
      @keyframes animateBackground {
        0% {
          background-position: 0 0;
        }
        100% {
          background-position: 100% 0;
        }
      }
      
      body::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, rgba(128, 128, 128, 0.15), rgba(128, 128, 128, 0.15));
        animation: animateShadow 10s infinite alternate;
        z-index: -1;
      }
      
      @keyframes animateShadow {
        0% {
          transform: scale(1);
          opacity: 0.5;
        }
        100% {
          transform: scale(1.2);
          opacity: 1;
        }
      }
      
      .leaderboard-container {
        text-align: center;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        background: linear-gradient(45deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.1));
        background-size: 50px 50px;
        background-position: 0 0;
        animation: animateTriangles 10s infinite linear;
      }
      
      @keyframes animateTriangles {
        0% {
          background-position: 0 0;
        }
        100% {
          background-position: 100% 0;
        }
      }
      
      .leaderboard-heading {
        font-size: 50px;
        margin-bottom: 20px;
        color: {{ user.accent_color if user else '#007bff' }};
        font-weight: bold;
      }
      
      .container-shadow {
        background-color: rgba(0, 0, 0, 0.7);
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        margin: 0 auto;
        max-width: 90%;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      
      .leaderboard-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px auto;
        border: 1px solid #444;
        table-layout: fixed;
      }
      
      .leaderboard-thead-th {
        font-size: 22px;
        padding: 15px;
        background-color: {{ user.background_color if user else '#000000' }};
        color: {{ user.text_color if user else '#ffffff' }};
        text-align: center;
        border: 1px solid #444;
      }
      
      .leaderboard-tbody-td {
        font-size: 18px;
        padding: 15px;
        border: 1px solid #444;
        text-align: center;
        color: #ffffff;
      }
      
      .leaderboard-tr {
        background-color: #000000;
      }
      
      .leaderboard-tr:hover {
        background-color: {{ user.gradient_color if user else 'rgb(0, 0, 0)' }};
      }
      
      .accent-link {
        color: #ffffff;
        text-decoration: none;
      }
      
      .accent-link:hover {
        text-decoration: underline;
      }
      
      .profile-picture-leaderboard {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        object-fit: cover;
      }
</style>

<div class="leaderboard-container">
    <h2 class="leaderboard-heading" style="color: color: {{ user.text_color if user else '#ffffff' }};">Leaderboard</h2>
    
    <div class="container-shadow">
        <table class="leaderboard-table">
            <thead>
                <tr>
                    <th class="leaderboard-thead-th" style="width: 10%;">Rank</th>
                    <th class="leaderboard-thead-th" style="width: 15%;">Profile Picture</th>
                    <th class="leaderboard-thead-th" style="width: 30%;">Username</th>
                    <th class="leaderboard-thead-th" style="width: 45%;">Account Value</th>
                </tr>
            </thead>
            <tbody>
                {% for user in leaderboard %}
                <tr class="leaderboard-tr">
                    <!-- Rank Column -->
                    <td class="leaderboard-tbody-td">{{ loop.index }}</td>

                    <!-- Profile Picture Column -->
                    <td class="leaderboard-tbody-td">
                        {% if user.profile_picture %}
                            <img src="{{ user.profile_picture }}" alt="Profile Picture" class="profile-picture-leaderboard">
                        {% else %}
                            <img src="{{ url_for('static', filename='default-profile.png') }}" alt="Default Profile Picture" class="profile-picture-leaderboard">
                        {% endif %}
                    </td>

                    <!-- Username Column -->
                    <td class="leaderboard-tbody-td">
                        <a class="accent-link" href="{{ url_for('view_portfolio', user_id=user['id']) }}" style="color: #fff; text-decoration: none;" 
                           onmouseover="this.style.textDecoration='underline'" 
                           onmouseout="this.style.textDecoration='none'">
                            {{ user['username'] }}
                        </a>
                    </td>

                    <!-- Account Value Column -->
                    <td class="leaderboard-tbody-td" style="color: {% if loop.index <= 3 %} green 
                                                               {% elif loop.index > leaderboard|length - 3 %} red 
                                                               {% else %} #fff {% endif %};">
                        ${{ user.account_value }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}